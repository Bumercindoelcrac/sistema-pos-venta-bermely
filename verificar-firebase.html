<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar Firebase - Ber-Mely</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a237e;
            margin-bottom: 20px;
            text-align: center;
        }
        
        h2 {
            color: #333;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .step {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .step h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .step p {
            margin-bottom: 10px;
        }
        
        code {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            display: block;
            margin: 10px 0;
            font-family: monospace;
            overflow-x: auto;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        button.success {
            background: #2ecc71;
        }
        
        button.success:hover {
            background: #27ae60;
        }
        
        button.danger {
            background: #e74c3c;
        }
        
        button.danger:hover {
            background: #c0392b;
        }
        
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background: #f8f9fa;
            display: none;
        }
        
        .test-result.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        .credential-box {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px dashed #f39c12;
        }
        
        .credential-box h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        ul {
            padding-left: 20px;
            margin: 15px 0;
        }
        
        li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Diagn√≥stico de Firebase - Ber-Mely</h1>
        
        <div id="status" class="status">
            Verificando conexi√≥n...
        </div>
        
        <h2>üìã Pasos para Configurar Firebase</h2>
        
        <div class="step">
            <h3>Paso 1: Ir a Firebase Console</h3>
            <p>Ve a <a href="https://console.firebase.google.com" target="_blank">console.firebase.google.com</a></p>
        </div>
        
        <div class="step">
            <h3>Paso 2: Crear o Seleccionar Proyecto</h3>
            <p>Selecciona el proyecto "bermely-f6385" o crea uno nuevo.</p>
        </div>
        
        <div class="step">
            <h3>Paso 3: Configurar Firestore Database</h3>
            <p>Ve a "Firestore Database" en el men√∫ lateral y haz clic en "Crear base de datos".</p>
            <p>Selecciona "Empezar en modo de prueba".</p>
        </div>
        
        <div class="step">
            <h3>Paso 4: Configurar Reglas de Seguridad</h3>
            <p>Ve a la pesta√±a "Reglas" y pega lo siguiente:</p>
            <code>
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
            </code>
            <p>Haz clic en "Publicar".</p>
        </div>
        
        <div class="step">
            <h3>Paso 5: Obtener Configuraci√≥n</h3>
            <p>Ve a "Configuraci√≥n del proyecto" ‚öôÔ∏è ‚Üí "Configuraci√≥n general"</p>
            <p>Despl√°zate hasta "Tus aplicaciones" y selecciona la app web.</p>
            <p>Copia la configuraci√≥n que aparece.</p>
        </div>
        
        <div class="credential-box">
            <h3>üîë Tus Credenciales Actuales</h3>
            <p><strong>apiKey:</strong> AIzaSyDHDcia2XdqLIrIdw3X9J34_IuKgI0FLos</p>
            <p><strong>authDomain:</strong> bermely-f6385.firebaseapp.com</p>
            <p><strong>projectId:</strong> bermely-f6385</p>
            <p><strong>storageBucket:</strong> bermely-f6385.firebasestorage.app</p>
            <p><strong>messagingSenderId:</strong> 372922286937</p>
            <p><strong>appId:</strong> 1:372922286937:web:9f51b0f767aed8991e4248</p>
        </div>
        
        <h2>üß™ Pruebas de Conexi√≥n</h2>
        
        <div class="step">
            <h3>Prueba 1: Conexi√≥n B√°sica</h3>
            <button onclick="probarConexion()">Probar Conexi√≥n a Firebase</button>
            <div id="test1" class="test-result"></div>
        </div>
        
        <div class="step">
            <h3>Prueba 2: Crear Colecciones</h3>
            <button onclick="crearColecciones()">Crear Colecciones B√°sicas</button>
            <div id="test2" class="test-result"></div>
        </div>
        
        <div class="step">
            <h3>Prueba 3: Login Simulado</h3>
            <button onclick="probarLogin()">Probar Login con admin/admin123</button>
            <div id="test3" class="test-result"></div>
        </div>
        
        <h2>üöÄ Acciones R√°pidas</h2>
        
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="success" onclick="irAlSistema()">
                üöÄ Ir al Sistema POS
            </button>
            <button onclick="limpiarLocalStorage()">
                üßπ Limpiar Datos Locales
            </button>
            <button class="danger" onclick="forzarModoDesarrollo()">
                ‚ö†Ô∏è Forzar Modo Desarrollo
            </button>
        </div>
        
        <h2>üìä Estado Actual</h2>
        <div id="currentStatus">
            Cargando informaci√≥n...
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    
    <script>
        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDHDcia2XdqLIrIdw3X9J34_IuKgI0FLos",
            authDomain: "bermely-f6385.firebaseapp.com",
            projectId: "bermely-f6385",
            storageBucket: "bermely-f6385.firebasestorage.app",
            messagingSenderId: "372922286937",
            appId: "1:372922286937:web:9f51b0f767aed8991e4248"
        };

        let db;
        let app;
        
        // Intentar inicializar Firebase
        try {
            app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            
            document.getElementById('status').className = 'status success';
            document.getElementById('status').innerHTML = '‚úÖ Firebase inicializado correctamente';
            
        } catch (error) {
            document.getElementById('status').className = 'status error';
            document.getElementById('status').innerHTML = `‚ùå Error: ${error.message}`;
        }
        
        // Mostrar estado actual
        function actualizarEstado() {
            const estadoDiv = document.getElementById('currentStatus');
            const usuario = JSON.parse(localStorage.getItem('usuario'));
            
            let html = `
                <div class="step">
                    <h3>Informaci√≥n del Sistema</h3>
                    <p><strong>Firebase:</strong> ${app ? '‚úÖ Conectado' : '‚ùå No conectado'}</p>
                    <p><strong>Base de datos:</strong> ${db ? '‚úÖ Disponible' : '‚ùå No disponible'}</p>
                    <p><strong>Usuario en sesi√≥n:</strong> ${usuario ? usuario.nombre + ' (' + usuario.rol + ')' : 'Ninguno'}</p>
                    <p><strong>Navegador:</strong> ${navigator.userAgent}</p>
                    <p><strong>Tiempo local:</strong> ${new Date().toLocaleString()}</p>
                </div>
            `;
            
            estadoDiv.innerHTML = html;
        }
        
        // Probar conexi√≥n
        async function probarConexion() {
            const testDiv = document.getElementById('test1');
            testDiv.className = 'test-result';
            testDiv.innerHTML = 'Probando...';
            
            try {
                if (!db) {
                    throw new Error("Firebase no est√° inicializado");
                }
                
                // Intentar una operaci√≥n simple
                await db.collection('test').doc('connection').set({
                    test: true,
                    timestamp: new Date().toISOString()
                });
                
                testDiv.className = 'test-result success';
                testDiv.innerHTML = '‚úÖ Conexi√≥n exitosa. Se cre√≥ documento de prueba.';
                
            } catch (error) {
                testDiv.className = 'test-result error';
                testDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        // Crear colecciones b√°sicas
        async function crearColecciones() {
            const testDiv = document.getElementById('test2');
            testDiv.className = 'test-result';
            testDiv.innerHTML = 'Creando colecciones...';
            
            try {
                // Crear usuarios predeterminados
                const usuarios = [
                    { usuario: 'admin', nombre: 'Administrador', password: 'admin123', rol: 'admin', activo: true },
                    { usuario: 'mesero1', nombre: 'Mesero 1', password: 'mesero123', rol: 'mesero', activo: true }
                ];
                
                for (const user of usuarios) {
                    await db.collection('usuarios').doc(user.usuario).set(user);
                }
                
                // Crear algunas mesas
                for (let i = 1; i <= 3; i++) {
                    await db.collection('mesas').doc(`mesa${i}`).set({
                        numero: i,
                        estado: 'libre',
                        cliente: '',
                        total: 0,
                        timestamp: new Date().toISOString()
                    });
                }
                
                testDiv.className = 'test-result success';
                testDiv.innerHTML = '‚úÖ Colecciones creadas exitosamente: usuarios, mesas';
                
            } catch (error) {
                testDiv.className = 'test-result error';
                testDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        // Probar login
        async function probarLogin() {
            const testDiv = document.getElementById('test3');
            testDiv.className = 'test-result';
            testDiv.innerHTML = 'Probando login...';
            
            try {
                // Buscar usuario admin
                const userDoc = await db.collection('usuarios').doc('admin').get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    
                    if (userData.password === 'admin123') {
                        // Guardar sesi√≥n
                        localStorage.setItem('usuario', JSON.stringify({
                            usuario: 'admin',
                            nombre: userData.nombre,
                            rol: userData.rol,
                            timestamp: Date.now()
                        }));
                        
                        testDiv.className = 'test-result success';
                        testDiv.innerHTML = '‚úÖ Login exitoso. Sesi√≥n guardada.';
                    } else {
                        testDiv.className = 'test-result error';
                        testDiv.innerHTML = '‚ùå Contrase√±a incorrecta';
                    }
                } else {
                    testDiv.className = 'test-result error';
                    testDiv.innerHTML = '‚ùå Usuario admin no encontrado';
                }
                
            } catch (error) {
                testDiv.className = 'test-result error';
                testDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        // Ir al sistema
        function irAlSistema() {
            window.location.href = 'index.html';
        }
        
        // Limpiar localStorage
        function limpiarLocalStorage() {
            localStorage.clear();
            alert('LocalStorage limpiado. Recarga la p√°gina.');
            location.reload();
        }
        
        // Forzar modo desarrollo
        function forzarModoDesarrollo() {
            localStorage.setItem('modo_desarrollo', 'true');
            alert('Modo desarrollo activado. Se usar√°n datos simulados.');
            window.location.href = 'index.html';
        }
        
        // Actualizar estado al cargar
        document.addEventListener('DOMContentLoaded', function() {
            actualizarEstado();
            setInterval(actualizarEstado, 5000); // Actualizar cada 5 segundos
        });
    </script>
</body>
</html>